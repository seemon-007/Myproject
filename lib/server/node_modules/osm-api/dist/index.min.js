(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.OSM=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],2:[function(require,module,exports){(function(Buffer){(function(){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}}).call(this)}).call(this,require("buffer").Buffer)},{"base64-js":1,buffer:2,ieee754:14}],3:[function(require,module,exports){"use strict";const validator=require("./validator");const XMLParser=require("./xmlparser/XMLParser");const XMLBuilder=require("./xmlbuilder/json2xml");module.exports={XMLParser:XMLParser,XMLValidator:validator,XMLBuilder:XMLBuilder}},{"./validator":5,"./xmlbuilder/json2xml":6,"./xmlparser/XMLParser":11}],4:[function(require,module,exports){"use strict";const nameStartChar=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";const nameChar=nameStartChar+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040";const nameRegexp="["+nameStartChar+"]["+nameChar+"]*";const regexName=new RegExp("^"+nameRegexp+"$");const getAllMatches=function(string,regex){const matches=[];let match=regex.exec(string);while(match){const allmatches=[];allmatches.startIndex=regex.lastIndex-match[0].length;const len=match.length;for(let index=0;index<len;index++){allmatches.push(match[index])}matches.push(allmatches);match=regex.exec(string)}return matches};const isName=function(string){const match=regexName.exec(string);return!(match===null||typeof match==="undefined")};exports.isExist=function(v){return typeof v!=="undefined"};exports.isEmptyObject=function(obj){return Object.keys(obj).length===0};exports.merge=function(target,a,arrayMode){if(a){const keys=Object.keys(a);const len=keys.length;for(let i=0;i<len;i++){if(arrayMode==="strict"){target[keys[i]]=[a[keys[i]]]}else{target[keys[i]]=a[keys[i]]}}}};exports.getValue=function(v){if(exports.isExist(v)){return v}else{return""}};exports.isName=isName;exports.getAllMatches=getAllMatches;exports.nameRegexp=nameRegexp},{}],5:[function(require,module,exports){"use strict";const util=require("./util");const defaultOptions={allowBooleanAttributes:false,unpairedTags:[]};exports.validate=function(xmlData,options){options=Object.assign({},defaultOptions,options);const tags=[];let tagFound=false;let reachedRoot=false;if(xmlData[0]==="\ufeff"){xmlData=xmlData.substr(1)}for(let i=0;i<xmlData.length;i++){if(xmlData[i]==="<"&&xmlData[i+1]==="?"){i+=2;i=readPI(xmlData,i);if(i.err)return i}else if(xmlData[i]==="<"){let tagStartPos=i;i++;if(xmlData[i]==="!"){i=readCommentAndCDATA(xmlData,i);continue}else{let closingTag=false;if(xmlData[i]==="/"){closingTag=true;i++}let tagName="";for(;i<xmlData.length&&xmlData[i]!==">"&&xmlData[i]!==" "&&xmlData[i]!=="\t"&&xmlData[i]!=="\n"&&xmlData[i]!=="\r";i++){tagName+=xmlData[i]}tagName=tagName.trim();if(tagName[tagName.length-1]==="/"){tagName=tagName.substring(0,tagName.length-1);i--}if(!validateTagName(tagName)){let msg;if(tagName.trim().length===0){msg="Invalid space after '<'."}else{msg="Tag '"+tagName+"' is an invalid name."}return getErrorObject("InvalidTag",msg,getLineNumberForPosition(xmlData,i))}const result=readAttributeStr(xmlData,i);if(result===false){return getErrorObject("InvalidAttr","Attributes for '"+tagName+"' have open quote.",getLineNumberForPosition(xmlData,i))}let attrStr=result.value;i=result.index;if(attrStr[attrStr.length-1]==="/"){const attrStrStart=i-attrStr.length;attrStr=attrStr.substring(0,attrStr.length-1);const isValid=validateAttributeString(attrStr,options);if(isValid===true){tagFound=true}else{return getErrorObject(isValid.err.code,isValid.err.msg,getLineNumberForPosition(xmlData,attrStrStart+isValid.err.line))}}else if(closingTag){if(!result.tagClosed){return getErrorObject("InvalidTag","Closing tag '"+tagName+"' doesn't have proper closing.",getLineNumberForPosition(xmlData,i))}else if(attrStr.trim().length>0){return getErrorObject("InvalidTag","Closing tag '"+tagName+"' can't have attributes or invalid starting.",getLineNumberForPosition(xmlData,tagStartPos))}else if(tags.length===0){return getErrorObject("InvalidTag","Closing tag '"+tagName+"' has not been opened.",getLineNumberForPosition(xmlData,tagStartPos))}else{const otg=tags.pop();if(tagName!==otg.tagName){let openPos=getLineNumberForPosition(xmlData,otg.tagStartPos);return getErrorObject("InvalidTag","Expected closing tag '"+otg.tagName+"' (opened in line "+openPos.line+", col "+openPos.col+") instead of closing tag '"+tagName+"'.",getLineNumberForPosition(xmlData,tagStartPos))}if(tags.length==0){reachedRoot=true}}}else{const isValid=validateAttributeString(attrStr,options);if(isValid!==true){return getErrorObject(isValid.err.code,isValid.err.msg,getLineNumberForPosition(xmlData,i-attrStr.length+isValid.err.line))}if(reachedRoot===true){return getErrorObject("InvalidXml","Multiple possible root nodes found.",getLineNumberForPosition(xmlData,i))}else if(options.unpairedTags.indexOf(tagName)!==-1){}else{tags.push({tagName:tagName,tagStartPos:tagStartPos})}tagFound=true}for(i++;i<xmlData.length;i++){if(xmlData[i]==="<"){if(xmlData[i+1]==="!"){i++;i=readCommentAndCDATA(xmlData,i);continue}else if(xmlData[i+1]==="?"){i=readPI(xmlData,++i);if(i.err)return i}else{break}}else if(xmlData[i]==="&"){const afterAmp=validateAmpersand(xmlData,i);if(afterAmp==-1)return getErrorObject("InvalidChar","char '&' is not expected.",getLineNumberForPosition(xmlData,i));i=afterAmp}else{if(reachedRoot===true&&!isWhiteSpace(xmlData[i])){return getErrorObject("InvalidXml","Extra text at the end",getLineNumberForPosition(xmlData,i))}}}if(xmlData[i]==="<"){i--}}}else{if(isWhiteSpace(xmlData[i])){continue}return getErrorObject("InvalidChar","char '"+xmlData[i]+"' is not expected.",getLineNumberForPosition(xmlData,i))}}if(!tagFound){return getErrorObject("InvalidXml","Start tag expected.",1)}else if(tags.length==1){return getErrorObject("InvalidTag","Unclosed tag '"+tags[0].tagName+"'.",getLineNumberForPosition(xmlData,tags[0].tagStartPos))}else if(tags.length>0){return getErrorObject("InvalidXml","Invalid '"+JSON.stringify(tags.map(t=>t.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}return true};function isWhiteSpace(char){return char===" "||char==="\t"||char==="\n"||char==="\r"}function readPI(xmlData,i){const start=i;for(;i<xmlData.length;i++){if(xmlData[i]=="?"||xmlData[i]==" "){const tagname=xmlData.substr(start,i-start);if(i>5&&tagname==="xml"){return getErrorObject("InvalidXml","XML declaration allowed only at the start of the document.",getLineNumberForPosition(xmlData,i))}else if(xmlData[i]=="?"&&xmlData[i+1]==">"){i++;break}else{continue}}}return i}function readCommentAndCDATA(xmlData,i){if(xmlData.length>i+5&&xmlData[i+1]==="-"&&xmlData[i+2]==="-"){for(i+=3;i<xmlData.length;i++){if(xmlData[i]==="-"&&xmlData[i+1]==="-"&&xmlData[i+2]===">"){i+=2;break}}}else if(xmlData.length>i+8&&xmlData[i+1]==="D"&&xmlData[i+2]==="O"&&xmlData[i+3]==="C"&&xmlData[i+4]==="T"&&xmlData[i+5]==="Y"&&xmlData[i+6]==="P"&&xmlData[i+7]==="E"){let angleBracketsCount=1;for(i+=8;i<xmlData.length;i++){if(xmlData[i]==="<"){angleBracketsCount++}else if(xmlData[i]===">"){angleBracketsCount--;if(angleBracketsCount===0){break}}}}else if(xmlData.length>i+9&&xmlData[i+1]==="["&&xmlData[i+2]==="C"&&xmlData[i+3]==="D"&&xmlData[i+4]==="A"&&xmlData[i+5]==="T"&&xmlData[i+6]==="A"&&xmlData[i+7]==="["){for(i+=8;i<xmlData.length;i++){if(xmlData[i]==="]"&&xmlData[i+1]==="]"&&xmlData[i+2]===">"){i+=2;break}}}return i}const doubleQuote='"';const singleQuote="'";function readAttributeStr(xmlData,i){let attrStr="";let startChar="";let tagClosed=false;for(;i<xmlData.length;i++){if(xmlData[i]===doubleQuote||xmlData[i]===singleQuote){if(startChar===""){startChar=xmlData[i]}else if(startChar!==xmlData[i]){}else{startChar=""}}else if(xmlData[i]===">"){if(startChar===""){tagClosed=true;break}}attrStr+=xmlData[i]}if(startChar!==""){return false}return{value:attrStr,index:i,tagClosed:tagClosed}}const validAttrStrRegxp=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function validateAttributeString(attrStr,options){const matches=util.getAllMatches(attrStr,validAttrStrRegxp);const attrNames={};for(let i=0;i<matches.length;i++){if(matches[i][1].length===0){return getErrorObject("InvalidAttr","Attribute '"+matches[i][2]+"' has no space in starting.",getPositionFromMatch(matches[i]))}else if(matches[i][3]!==undefined&&matches[i][4]===undefined){return getErrorObject("InvalidAttr","Attribute '"+matches[i][2]+"' is without value.",getPositionFromMatch(matches[i]))}else if(matches[i][3]===undefined&&!options.allowBooleanAttributes){return getErrorObject("InvalidAttr","boolean attribute '"+matches[i][2]+"' is not allowed.",getPositionFromMatch(matches[i]))}const attrName=matches[i][2];if(!validateAttrName(attrName)){return getErrorObject("InvalidAttr","Attribute '"+attrName+"' is an invalid name.",getPositionFromMatch(matches[i]))}if(!attrNames.hasOwnProperty(attrName)){attrNames[attrName]=1}else{return getErrorObject("InvalidAttr","Attribute '"+attrName+"' is repeated.",getPositionFromMatch(matches[i]))}}return true}function validateNumberAmpersand(xmlData,i){let re=/\d/;if(xmlData[i]==="x"){i++;re=/[\da-fA-F]/}for(;i<xmlData.length;i++){if(xmlData[i]===";")return i;if(!xmlData[i].match(re))break}return-1}function validateAmpersand(xmlData,i){i++;if(xmlData[i]===";")return-1;if(xmlData[i]==="#"){i++;return validateNumberAmpersand(xmlData,i)}let count=0;for(;i<xmlData.length;i++,count++){if(xmlData[i].match(/\w/)&&count<20)continue;if(xmlData[i]===";")break;return-1}return i}function getErrorObject(code,message,lineNumber){return{err:{code:code,msg:message,line:lineNumber.line||lineNumber,col:lineNumber.col}}}function validateAttrName(attrName){return util.isName(attrName)}function validateTagName(tagname){return util.isName(tagname)}function getLineNumberForPosition(xmlData,index){const lines=xmlData.substring(0,index).split(/\r?\n/);return{line:lines.length,col:lines[lines.length-1].length+1}}function getPositionFromMatch(match){return match.startIndex+match[1].length}},{"./util":4}],6:[function(require,module,exports){"use strict";const buildFromOrderedJs=require("./orderedJs2Xml");const defaultOptions={attributeNamePrefix:"@_",attributesGroupName:false,textNodeName:"#text",ignoreAttributes:true,cdataPropName:false,format:false,indentBy:"  ",suppressEmptyNode:false,suppressUnpairedNode:true,suppressBooleanAttributes:true,tagValueProcessor:function(key,a){return a},attributeValueProcessor:function(attrName,a){return a},preserveOrder:false,commentPropName:false,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:true,stopNodes:[],oneListGroup:false};function Builder(options){this.options=Object.assign({},defaultOptions,options);if(this.options.ignoreAttributes||this.options.attributesGroupName){this.isAttribute=function(){return false}}else{this.attrPrefixLen=this.options.attributeNamePrefix.length;this.isAttribute=isAttribute}this.processTextOrObjNode=processTextOrObjNode;if(this.options.format){this.indentate=indentate;this.tagEndChar=">\n";this.newLine="\n"}else{this.indentate=function(){return""};this.tagEndChar=">";this.newLine=""}}Builder.prototype.build=function(jObj){if(this.options.preserveOrder){return buildFromOrderedJs(jObj,this.options)}else{if(Array.isArray(jObj)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1){jObj={[this.options.arrayNodeName]:jObj}}return this.j2x(jObj,0).val}};Builder.prototype.j2x=function(jObj,level){let attrStr="";let val="";for(let key in jObj){if(!Object.prototype.hasOwnProperty.call(jObj,key))continue;if(typeof jObj[key]==="undefined"){if(this.isAttribute(key)){val+=""}}else if(jObj[key]===null){if(this.isAttribute(key)){val+=""}else if(key[0]==="?"){val+=this.indentate(level)+"<"+key+"?"+this.tagEndChar}else{val+=this.indentate(level)+"<"+key+"/"+this.tagEndChar}}else if(jObj[key]instanceof Date){val+=this.buildTextValNode(jObj[key],key,"",level)}else if(typeof jObj[key]!=="object"){const attr=this.isAttribute(key);if(attr){attrStr+=this.buildAttrPairStr(attr,""+jObj[key])}else{if(key===this.options.textNodeName){let newval=this.options.tagValueProcessor(key,""+jObj[key]);val+=this.replaceEntitiesValue(newval)}else{val+=this.buildTextValNode(jObj[key],key,"",level)}}}else if(Array.isArray(jObj[key])){const arrLen=jObj[key].length;let listTagVal="";let listTagAttr="";for(let j=0;j<arrLen;j++){const item=jObj[key][j];if(typeof item==="undefined"){}else if(item===null){if(key[0]==="?")val+=this.indentate(level)+"<"+key+"?"+this.tagEndChar;else val+=this.indentate(level)+"<"+key+"/"+this.tagEndChar}else if(typeof item==="object"){if(this.options.oneListGroup){const result=this.j2x(item,level+1);listTagVal+=result.val;if(this.options.attributesGroupName&&item.hasOwnProperty(this.options.attributesGroupName)){listTagAttr+=result.attrStr}}else{listTagVal+=this.processTextOrObjNode(item,key,level)}}else{if(this.options.oneListGroup){let textValue=this.options.tagValueProcessor(key,item);textValue=this.replaceEntitiesValue(textValue);listTagVal+=textValue}else{listTagVal+=this.buildTextValNode(item,key,"",level)}}}if(this.options.oneListGroup){listTagVal=this.buildObjectNode(listTagVal,key,listTagAttr,level)}val+=listTagVal}else{if(this.options.attributesGroupName&&key===this.options.attributesGroupName){const Ks=Object.keys(jObj[key]);const L=Ks.length;for(let j=0;j<L;j++){attrStr+=this.buildAttrPairStr(Ks[j],""+jObj[key][Ks[j]])}}else{val+=this.processTextOrObjNode(jObj[key],key,level)}}}return{attrStr:attrStr,val:val}};Builder.prototype.buildAttrPairStr=function(attrName,val){val=this.options.attributeValueProcessor(attrName,""+val);val=this.replaceEntitiesValue(val);if(this.options.suppressBooleanAttributes&&val==="true"){return" "+attrName}else return" "+attrName+'="'+val+'"'};function processTextOrObjNode(object,key,level){const result=this.j2x(object,level+1);if(object[this.options.textNodeName]!==undefined&&Object.keys(object).length===1){return this.buildTextValNode(object[this.options.textNodeName],key,result.attrStr,level)}else{return this.buildObjectNode(result.val,key,result.attrStr,level)}}Builder.prototype.buildObjectNode=function(val,key,attrStr,level){if(val===""){if(key[0]==="?")return this.indentate(level)+"<"+key+attrStr+"?"+this.tagEndChar;else{return this.indentate(level)+"<"+key+attrStr+this.closeTag(key)+this.tagEndChar}}else{let tagEndExp="</"+key+this.tagEndChar;let piClosingChar="";if(key[0]==="?"){piClosingChar="?";tagEndExp=""}if((attrStr||attrStr==="")&&val.indexOf("<")===-1){return this.indentate(level)+"<"+key+attrStr+piClosingChar+">"+val+tagEndExp}else if(this.options.commentPropName!==false&&key===this.options.commentPropName&&piClosingChar.length===0){return this.indentate(level)+`<!--${val}-->`+this.newLine}else{return this.indentate(level)+"<"+key+attrStr+piClosingChar+this.tagEndChar+val+this.indentate(level)+tagEndExp}}};Builder.prototype.closeTag=function(key){let closeTag="";if(this.options.unpairedTags.indexOf(key)!==-1){if(!this.options.suppressUnpairedNode)closeTag="/"}else if(this.options.suppressEmptyNode){closeTag="/"}else{closeTag=`></${key}`}return closeTag};function buildEmptyObjNode(val,key,attrStr,level){if(val!==""){return this.buildObjectNode(val,key,attrStr,level)}else{if(key[0]==="?")return this.indentate(level)+"<"+key+attrStr+"?"+this.tagEndChar;else{return this.indentate(level)+"<"+key+attrStr+"/"+this.tagEndChar}}}Builder.prototype.buildTextValNode=function(val,key,attrStr,level){if(this.options.cdataPropName!==false&&key===this.options.cdataPropName){return this.indentate(level)+`<![CDATA[${val}]]>`+this.newLine}else if(this.options.commentPropName!==false&&key===this.options.commentPropName){return this.indentate(level)+`<!--${val}-->`+this.newLine}else if(key[0]==="?"){return this.indentate(level)+"<"+key+attrStr+"?"+this.tagEndChar}else{let textValue=this.options.tagValueProcessor(key,val);textValue=this.replaceEntitiesValue(textValue);if(textValue===""){return this.indentate(level)+"<"+key+attrStr+this.closeTag(key)+this.tagEndChar}else{return this.indentate(level)+"<"+key+attrStr+">"+textValue+"</"+key+this.tagEndChar}}};Builder.prototype.replaceEntitiesValue=function(textValue){if(textValue&&textValue.length>0&&this.options.processEntities){for(let i=0;i<this.options.entities.length;i++){const entity=this.options.entities[i];textValue=textValue.replace(entity.regex,entity.val)}}return textValue};function indentate(level){return this.options.indentBy.repeat(level)}function isAttribute(name){if(name.startsWith(this.options.attributeNamePrefix)&&name!==this.options.textNodeName){return name.substr(this.attrPrefixLen)}else{return false}}module.exports=Builder},{"./orderedJs2Xml":7}],7:[function(require,module,exports){const EOL="\n";function toXml(jArray,options){let indentation="";if(options.format&&options.indentBy.length>0){indentation=EOL}return arrToStr(jArray,options,"",indentation)}function arrToStr(arr,options,jPath,indentation){let xmlStr="";let isPreviousElementTag=false;for(let i=0;i<arr.length;i++){const tagObj=arr[i];const tagName=propName(tagObj);if(tagName===undefined)continue;let newJPath="";if(jPath.length===0)newJPath=tagName;else newJPath=`${jPath}.${tagName}`;if(tagName===options.textNodeName){let tagText=tagObj[tagName];if(!isStopNode(newJPath,options)){tagText=options.tagValueProcessor(tagName,tagText);tagText=replaceEntitiesValue(tagText,options)}if(isPreviousElementTag){xmlStr+=indentation}xmlStr+=tagText;isPreviousElementTag=false;continue}else if(tagName===options.cdataPropName){if(isPreviousElementTag){xmlStr+=indentation}xmlStr+=`<![CDATA[${tagObj[tagName][0][options.textNodeName]}]]>`;isPreviousElementTag=false;continue}else if(tagName===options.commentPropName){xmlStr+=indentation+`<!--${tagObj[tagName][0][options.textNodeName]}-->`;isPreviousElementTag=true;continue}else if(tagName[0]==="?"){const attStr=attr_to_str(tagObj[":@"],options);const tempInd=tagName==="?xml"?"":indentation;let piTextNodeName=tagObj[tagName][0][options.textNodeName];piTextNodeName=piTextNodeName.length!==0?" "+piTextNodeName:"";xmlStr+=tempInd+`<${tagName}${piTextNodeName}${attStr}?>`;isPreviousElementTag=true;continue}let newIdentation=indentation;if(newIdentation!==""){newIdentation+=options.indentBy}const attStr=attr_to_str(tagObj[":@"],options);const tagStart=indentation+`<${tagName}${attStr}`;const tagValue=arrToStr(tagObj[tagName],options,newJPath,newIdentation);if(options.unpairedTags.indexOf(tagName)!==-1){if(options.suppressUnpairedNode)xmlStr+=tagStart+">";else xmlStr+=tagStart+"/>"}else if((!tagValue||tagValue.length===0)&&options.suppressEmptyNode){xmlStr+=tagStart+"/>"}else if(tagValue&&tagValue.endsWith(">")){xmlStr+=tagStart+`>${tagValue}${indentation}</${tagName}>`}else{xmlStr+=tagStart+">";if(tagValue&&indentation!==""&&(tagValue.includes("/>")||tagValue.includes("</"))){xmlStr+=indentation+options.indentBy+tagValue+indentation}else{xmlStr+=tagValue}xmlStr+=`</${tagName}>`}isPreviousElementTag=true}return xmlStr}function propName(obj){const keys=Object.keys(obj);for(let i=0;i<keys.length;i++){const key=keys[i];if(!obj.hasOwnProperty(key))continue;if(key!==":@")return key}}function attr_to_str(attrMap,options){let attrStr="";if(attrMap&&!options.ignoreAttributes){for(let attr in attrMap){if(!attrMap.hasOwnProperty(attr))continue;let attrVal=options.attributeValueProcessor(attr,attrMap[attr]);attrVal=replaceEntitiesValue(attrVal,options);if(attrVal===true&&options.suppressBooleanAttributes){attrStr+=` ${attr.substr(options.attributeNamePrefix.length)}`}else{attrStr+=` ${attr.substr(options.attributeNamePrefix.length)}="${attrVal}"`}}}return attrStr}function isStopNode(jPath,options){jPath=jPath.substr(0,jPath.length-options.textNodeName.length-1);let tagName=jPath.substr(jPath.lastIndexOf(".")+1);for(let index in options.stopNodes){if(options.stopNodes[index]===jPath||options.stopNodes[index]==="*."+tagName)return true}return false}function replaceEntitiesValue(textValue,options){if(textValue&&textValue.length>0&&options.processEntities){for(let i=0;i<options.entities.length;i++){const entity=options.entities[i];textValue=textValue.replace(entity.regex,entity.val)}}return textValue}module.exports=toXml},{}],8:[function(require,module,exports){const util=require("../util");function readDocType(xmlData,i){const entities={};if(xmlData[i+3]==="O"&&xmlData[i+4]==="C"&&xmlData[i+5]==="T"&&xmlData[i+6]==="Y"&&xmlData[i+7]==="P"&&xmlData[i+8]==="E"){i=i+9;let angleBracketsCount=1;let hasBody=false,comment=false;let exp="";for(;i<xmlData.length;i++){if(xmlData[i]==="<"&&!comment){if(hasBody&&isEntity(xmlData,i)){i+=7;[entityName,val,i]=readEntityExp(xmlData,i+1);if(val.indexOf("&")===-1)entities[validateEntityName(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val}}else if(hasBody&&isElement(xmlData,i))i+=8;else if(hasBody&&isAttlist(xmlData,i))i+=8;else if(hasBody&&isNotation(xmlData,i))i+=9;else if(isComment)comment=true;else throw new Error("Invalid DOCTYPE");angleBracketsCount++;exp=""}else if(xmlData[i]===">"){if(comment){if(xmlData[i-1]==="-"&&xmlData[i-2]==="-"){comment=false;angleBracketsCount--}}else{angleBracketsCount--}if(angleBracketsCount===0){break}}else if(xmlData[i]==="["){hasBody=true}else{exp+=xmlData[i]}}if(angleBracketsCount!==0){throw new Error(`Unclosed DOCTYPE`)}}else{throw new Error(`Invalid Tag instead of DOCTYPE`)}return{entities:entities,i:i}}function readEntityExp(xmlData,i){let entityName="";for(;i<xmlData.length&&(xmlData[i]!=="'"&&xmlData[i]!=='"');i++){entityName+=xmlData[i]}entityName=entityName.trim();if(entityName.indexOf(" ")!==-1)throw new Error("External entites are not supported");const startChar=xmlData[i++];let val="";for(;i<xmlData.length&&xmlData[i]!==startChar;i++){val+=xmlData[i]}return[entityName,val,i]}function isComment(xmlData,i){if(xmlData[i+1]==="!"&&xmlData[i+2]==="-"&&xmlData[i+3]==="-")return true;return false}function isEntity(xmlData,i){if(xmlData[i+1]==="!"&&xmlData[i+2]==="E"&&xmlData[i+3]==="N"&&xmlData[i+4]==="T"&&xmlData[i+5]==="I"&&xmlData[i+6]==="T"&&xmlData[i+7]==="Y")return true;return false}function isElement(xmlData,i){if(xmlData[i+1]==="!"&&xmlData[i+2]==="E"&&xmlData[i+3]==="L"&&xmlData[i+4]==="E"&&xmlData[i+5]==="M"&&xmlData[i+6]==="E"&&xmlData[i+7]==="N"&&xmlData[i+8]==="T")return true;return false}function isAttlist(xmlData,i){if(xmlData[i+1]==="!"&&xmlData[i+2]==="A"&&xmlData[i+3]==="T"&&xmlData[i+4]==="T"&&xmlData[i+5]==="L"&&xmlData[i+6]==="I"&&xmlData[i+7]==="S"&&xmlData[i+8]==="T")return true;return false}function isNotation(xmlData,i){if(xmlData[i+1]==="!"&&xmlData[i+2]==="N"&&xmlData[i+3]==="O"&&xmlData[i+4]==="T"&&xmlData[i+5]==="A"&&xmlData[i+6]==="T"&&xmlData[i+7]==="I"&&xmlData[i+8]==="O"&&xmlData[i+9]==="N")return true;return false}function validateEntityName(name){if(util.isName(name))return name;else throw new Error(`Invalid entity name ${name}`)}module.exports=readDocType},{"../util":4}],9:[function(require,module,exports){const defaultOptions={preserveOrder:false,attributeNamePrefix:"@_",attributesGroupName:false,textNodeName:"#text",ignoreAttributes:true,removeNSPrefix:false,allowBooleanAttributes:false,parseTagValue:true,parseAttributeValue:false,trimValues:true,cdataPropName:false,numberParseOptions:{hex:true,leadingZeros:true,eNotation:true},tagValueProcessor:function(tagName,val){return val},attributeValueProcessor:function(attrName,val){return val},stopNodes:[],alwaysCreateTextNode:false,isArray:()=>false,commentPropName:false,unpairedTags:[],processEntities:true,htmlEntities:false,ignoreDeclaration:false,ignorePiTags:false,transformTagName:false,transformAttributeName:false,updateTag:function(tagName,jPath,attrs){return tagName}};const buildOptions=function(options){return Object.assign({},defaultOptions,options)};exports.buildOptions=buildOptions;exports.defaultOptions=defaultOptions},{}],10:[function(require,module,exports){"use strict";const util=require("../util");const xmlNode=require("./xmlNode");const readDocType=require("./DocTypeReader");const toNumber=require("strnum");class OrderedObjParser{constructor(options){this.options=options;this.currentNode=null;this.tagsNodeStack=[];this.docTypeEntities={};this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}};this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"};this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(_,str)=>String.fromCharCode(Number.parseInt(str,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(_,str)=>String.fromCharCode(Number.parseInt(str,16))}};this.addExternalEntities=addExternalEntities;this.parseXml=parseXml;this.parseTextData=parseTextData;this.resolveNameSpace=resolveNameSpace;this.buildAttributesMap=buildAttributesMap;this.isItStopNode=isItStopNode;this.replaceEntitiesValue=replaceEntitiesValue;this.readStopNodeData=readStopNodeData;this.saveTextToParentTag=saveTextToParentTag;this.addChild=addChild}}function addExternalEntities(externalEntities){const entKeys=Object.keys(externalEntities);for(let i=0;i<entKeys.length;i++){const ent=entKeys[i];this.lastEntities[ent]={regex:new RegExp("&"+ent+";","g"),val:externalEntities[ent]}}}function parseTextData(val,tagName,jPath,dontTrim,hasAttributes,isLeafNode,escapeEntities){if(val!==undefined){if(this.options.trimValues&&!dontTrim){val=val.trim()}if(val.length>0){if(!escapeEntities)val=this.replaceEntitiesValue(val);const newval=this.options.tagValueProcessor(tagName,val,jPath,hasAttributes,isLeafNode);if(newval===null||newval===undefined){return val}else if(typeof newval!==typeof val||newval!==val){return newval}else if(this.options.trimValues){return parseValue(val,this.options.parseTagValue,this.options.numberParseOptions)}else{const trimmedVal=val.trim();if(trimmedVal===val){return parseValue(val,this.options.parseTagValue,this.options.numberParseOptions)}else{return val}}}}}function resolveNameSpace(tagname){if(this.options.removeNSPrefix){const tags=tagname.split(":");const prefix=tagname.charAt(0)==="/"?"/":"";if(tags[0]==="xmlns"){return""}if(tags.length===2){tagname=prefix+tags[1]}}return tagname}const attrsRegx=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function buildAttributesMap(attrStr,jPath,tagName){if(!this.options.ignoreAttributes&&typeof attrStr==="string"){const matches=util.getAllMatches(attrStr,attrsRegx);const len=matches.length;const attrs={};for(let i=0;i<len;i++){const attrName=this.resolveNameSpace(matches[i][1]);let oldVal=matches[i][4];let aName=this.options.attributeNamePrefix+attrName;if(attrName.length){if(this.options.transformAttributeName){aName=this.options.transformAttributeName(aName)}if(aName==="__proto__")aName="#__proto__";if(oldVal!==undefined){if(this.options.trimValues){oldVal=oldVal.trim()}oldVal=this.replaceEntitiesValue(oldVal);const newVal=this.options.attributeValueProcessor(attrName,oldVal,jPath);if(newVal===null||newVal===undefined){attrs[aName]=oldVal}else if(typeof newVal!==typeof oldVal||newVal!==oldVal){attrs[aName]=newVal}else{attrs[aName]=parseValue(oldVal,this.options.parseAttributeValue,this.options.numberParseOptions)}}else if(this.options.allowBooleanAttributes){attrs[aName]=true}}}if(!Object.keys(attrs).length){return}if(this.options.attributesGroupName){const attrCollection={};attrCollection[this.options.attributesGroupName]=attrs;return attrCollection}return attrs}}const parseXml=function(xmlData){xmlData=xmlData.replace(/\r\n?/g,"\n");const xmlObj=new xmlNode("!xml");let currentNode=xmlObj;let textData="";let jPath="";for(let i=0;i<xmlData.length;i++){const ch=xmlData[i];if(ch==="<"){if(xmlData[i+1]==="/"){const closeIndex=findClosingIndex(xmlData,">",i,"Closing Tag is not closed.");let tagName=xmlData.substring(i+2,closeIndex).trim();if(this.options.removeNSPrefix){const colonIndex=tagName.indexOf(":");if(colonIndex!==-1){tagName=tagName.substr(colonIndex+1)}}if(this.options.transformTagName){tagName=this.options.transformTagName(tagName)}if(currentNode){textData=this.saveTextToParentTag(textData,currentNode,jPath)}const lastTagName=jPath.substring(jPath.lastIndexOf(".")+1);if(tagName&&this.options.unpairedTags.indexOf(tagName)!==-1){throw new Error(`Unpaired tag can not be used as closing tag: </${tagName}>`)}let propIndex=0;if(lastTagName&&this.options.unpairedTags.indexOf(lastTagName)!==-1){propIndex=jPath.lastIndexOf(".",jPath.lastIndexOf(".")-1);this.tagsNodeStack.pop()}else{propIndex=jPath.lastIndexOf(".")}jPath=jPath.substring(0,propIndex);currentNode=this.tagsNodeStack.pop();textData="";i=closeIndex}else if(xmlData[i+1]==="?"){let tagData=readTagExp(xmlData,i,false,"?>");if(!tagData)throw new Error("Pi Tag is not closed.");textData=this.saveTextToParentTag(textData,currentNode,jPath);if(this.options.ignoreDeclaration&&tagData.tagName==="?xml"||this.options.ignorePiTags){}else{const childNode=new xmlNode(tagData.tagName);childNode.add(this.options.textNodeName,"");if(tagData.tagName!==tagData.tagExp&&tagData.attrExpPresent){childNode[":@"]=this.buildAttributesMap(tagData.tagExp,jPath,tagData.tagName)}this.addChild(currentNode,childNode,jPath)}i=tagData.closeIndex+1}else if(xmlData.substr(i+1,3)==="!--"){const endIndex=findClosingIndex(xmlData,"--\x3e",i+4,"Comment is not closed.");if(this.options.commentPropName){const comment=xmlData.substring(i+4,endIndex-2);textData=this.saveTextToParentTag(textData,currentNode,jPath);currentNode.add(this.options.commentPropName,[{[this.options.textNodeName]:comment}])}i=endIndex}else if(xmlData.substr(i+1,2)==="!D"){const result=readDocType(xmlData,i);this.docTypeEntities=result.entities;i=result.i}else if(xmlData.substr(i+1,2)==="!["){const closeIndex=findClosingIndex(xmlData,"]]>",i,"CDATA is not closed.")-2;const tagExp=xmlData.substring(i+9,closeIndex);textData=this.saveTextToParentTag(textData,currentNode,jPath);let val=this.parseTextData(tagExp,currentNode.tagname,jPath,true,false,true,true);if(val==undefined)val="";if(this.options.cdataPropName){currentNode.add(this.options.cdataPropName,[{[this.options.textNodeName]:tagExp}])}else{currentNode.add(this.options.textNodeName,val)}i=closeIndex+2}else{let result=readTagExp(xmlData,i,this.options.removeNSPrefix);let tagName=result.tagName;const rawTagName=result.rawTagName;let tagExp=result.tagExp;let attrExpPresent=result.attrExpPresent;let closeIndex=result.closeIndex;if(this.options.transformTagName){tagName=this.options.transformTagName(tagName)}if(currentNode&&textData){if(currentNode.tagname!=="!xml"){textData=this.saveTextToParentTag(textData,currentNode,jPath,false)}}const lastTag=currentNode;if(lastTag&&this.options.unpairedTags.indexOf(lastTag.tagname)!==-1){currentNode=this.tagsNodeStack.pop();jPath=jPath.substring(0,jPath.lastIndexOf("."))}if(tagName!==xmlObj.tagname){jPath+=jPath?"."+tagName:tagName}if(this.isItStopNode(this.options.stopNodes,jPath,tagName)){let tagContent="";if(tagExp.length>0&&tagExp.lastIndexOf("/")===tagExp.length-1){if(tagName[tagName.length-1]==="/"){tagName=tagName.substr(0,tagName.length-1);jPath=jPath.substr(0,jPath.length-1);tagExp=tagName}else{tagExp=tagExp.substr(0,tagExp.length-1)}i=result.closeIndex}else if(this.options.unpairedTags.indexOf(tagName)!==-1){i=result.closeIndex}else{const result=this.readStopNodeData(xmlData,rawTagName,closeIndex+1);if(!result)throw new Error(`Unexpected end of ${rawTagName}`);i=result.i;tagContent=result.tagContent}const childNode=new xmlNode(tagName);if(tagName!==tagExp&&attrExpPresent){childNode[":@"]=this.buildAttributesMap(tagExp,jPath,tagName)}if(tagContent){tagContent=this.parseTextData(tagContent,tagName,jPath,true,attrExpPresent,true,true)}jPath=jPath.substr(0,jPath.lastIndexOf("."));childNode.add(this.options.textNodeName,tagContent);this.addChild(currentNode,childNode,jPath)}else{if(tagExp.length>0&&tagExp.lastIndexOf("/")===tagExp.length-1){if(tagName[tagName.length-1]==="/"){tagName=tagName.substr(0,tagName.length-1);jPath=jPath.substr(0,jPath.length-1);tagExp=tagName}else{tagExp=tagExp.substr(0,tagExp.length-1)}if(this.options.transformTagName){tagName=this.options.transformTagName(tagName)}const childNode=new xmlNode(tagName);if(tagName!==tagExp&&attrExpPresent){childNode[":@"]=this.buildAttributesMap(tagExp,jPath,tagName)}this.addChild(currentNode,childNode,jPath);jPath=jPath.substr(0,jPath.lastIndexOf("."))}else{const childNode=new xmlNode(tagName);this.tagsNodeStack.push(currentNode);if(tagName!==tagExp&&attrExpPresent){childNode[":@"]=this.buildAttributesMap(tagExp,jPath,tagName)}this.addChild(currentNode,childNode,jPath);currentNode=childNode}textData="";i=closeIndex}}}else{textData+=xmlData[i]}}return xmlObj.child};function addChild(currentNode,childNode,jPath){const result=this.options.updateTag(childNode.tagname,jPath,childNode[":@"]);if(result===false){}else if(typeof result==="string"){childNode.tagname=result;currentNode.addChild(childNode)}else{currentNode.addChild(childNode)}}const replaceEntitiesValue=function(val){if(this.options.processEntities){for(let entityName in this.docTypeEntities){const entity=this.docTypeEntities[entityName];val=val.replace(entity.regx,entity.val)}for(let entityName in this.lastEntities){const entity=this.lastEntities[entityName];val=val.replace(entity.regex,entity.val)}if(this.options.htmlEntities){for(let entityName in this.htmlEntities){const entity=this.htmlEntities[entityName];val=val.replace(entity.regex,entity.val)}}val=val.replace(this.ampEntity.regex,this.ampEntity.val)}return val};function saveTextToParentTag(textData,currentNode,jPath,isLeafNode){if(textData){if(isLeafNode===undefined)isLeafNode=Object.keys(currentNode.child).length===0;textData=this.parseTextData(textData,currentNode.tagname,jPath,false,currentNode[":@"]?Object.keys(currentNode[":@"]).length!==0:false,isLeafNode);if(textData!==undefined&&textData!=="")currentNode.add(this.options.textNodeName,textData);textData=""}return textData}function isItStopNode(stopNodes,jPath,currentTagName){const allNodesExp="*."+currentTagName;for(const stopNodePath in stopNodes){const stopNodeExp=stopNodes[stopNodePath];if(allNodesExp===stopNodeExp||jPath===stopNodeExp)return true}return false}function tagExpWithClosingIndex(xmlData,i,closingChar=">"){let attrBoundary;let tagExp="";for(let index=i;index<xmlData.length;index++){let ch=xmlData[index];if(attrBoundary){if(ch===attrBoundary)attrBoundary=""}else if(ch==='"'||ch==="'"){attrBoundary=ch}else if(ch===closingChar[0]){if(closingChar[1]){if(xmlData[index+1]===closingChar[1]){return{data:tagExp,index:index}}}else{return{data:tagExp,index:index}}}else if(ch==="\t"){ch=" "}tagExp+=ch}}function findClosingIndex(xmlData,str,i,errMsg){const closingIndex=xmlData.indexOf(str,i);if(closingIndex===-1){throw new Error(errMsg)}else{return closingIndex+str.length-1}}function readTagExp(xmlData,i,removeNSPrefix,closingChar=">"){const result=tagExpWithClosingIndex(xmlData,i+1,closingChar);if(!result)return;let tagExp=result.data;const closeIndex=result.index;const separatorIndex=tagExp.search(/\s/);let tagName=tagExp;let attrExpPresent=true;if(separatorIndex!==-1){tagName=tagExp.substring(0,separatorIndex);tagExp=tagExp.substring(separatorIndex+1).trimStart()}const rawTagName=tagName;if(removeNSPrefix){const colonIndex=tagName.indexOf(":");if(colonIndex!==-1){tagName=tagName.substr(colonIndex+1);attrExpPresent=tagName!==result.data.substr(colonIndex+1)}}return{tagName:tagName,tagExp:tagExp,closeIndex:closeIndex,attrExpPresent:attrExpPresent,rawTagName:rawTagName}}function readStopNodeData(xmlData,tagName,i){const startIndex=i;let openTagCount=1;for(;i<xmlData.length;i++){if(xmlData[i]==="<"){if(xmlData[i+1]==="/"){const closeIndex=findClosingIndex(xmlData,">",i,`${tagName} is not closed`);let closeTagName=xmlData.substring(i+2,closeIndex).trim();if(closeTagName===tagName){openTagCount--;if(openTagCount===0){return{tagContent:xmlData.substring(startIndex,i),i:closeIndex}}}i=closeIndex}else if(xmlData[i+1]==="?"){const closeIndex=findClosingIndex(xmlData,"?>",i+1,"StopNode is not closed.");i=closeIndex}else if(xmlData.substr(i+1,3)==="!--"){const closeIndex=findClosingIndex(xmlData,"--\x3e",i+3,"StopNode is not closed.");i=closeIndex}else if(xmlData.substr(i+1,2)==="!["){const closeIndex=findClosingIndex(xmlData,"]]>",i,"StopNode is not closed.")-2;i=closeIndex}else{const tagData=readTagExp(xmlData,i,">");if(tagData){const openTagName=tagData&&tagData.tagName;if(openTagName===tagName&&tagData.tagExp[tagData.tagExp.length-1]!=="/"){openTagCount++}i=tagData.closeIndex}}}}}function parseValue(val,shouldParse,options){if(shouldParse&&typeof val==="string"){const newval=val.trim();if(newval==="true")return true;else if(newval==="false")return false;else return toNumber(val,options)}else{if(util.isExist(val)){return val}else{return""}}}module.exports=OrderedObjParser},{"../util":4,"./DocTypeReader":8,"./xmlNode":13,strnum:15}],11:[function(require,module,exports){const{buildOptions}=require("./OptionsBuilder");const OrderedObjParser=require("./OrderedObjParser");const{prettify}=require("./node2json");const validator=require("../validator");class XMLParser{constructor(options){this.externalEntities={};this.options=buildOptions(options)}parse(xmlData,validationOption){if(typeof xmlData==="string"){}else if(xmlData.toString){xmlData=xmlData.toString()}else{throw new Error("XML data is accepted in String or Bytes[] form.")}if(validationOption){if(validationOption===true)validationOption={};const result=validator.validate(xmlData,validationOption);if(result!==true){throw Error(`${result.err.msg}:${result.err.line}:${result.err.col}`)}}const orderedObjParser=new OrderedObjParser(this.options);orderedObjParser.addExternalEntities(this.externalEntities);const orderedResult=orderedObjParser.parseXml(xmlData);if(this.options.preserveOrder||orderedResult===undefined)return orderedResult;else return prettify(orderedResult,this.options)}addEntity(key,value){if(value.indexOf("&")!==-1){throw new Error("Entity value can't have '&'")}else if(key.indexOf("&")!==-1||key.indexOf(";")!==-1){throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'")}else if(value==="&"){throw new Error("An entity with value '&' is not permitted")}else{this.externalEntities[key]=value}}}module.exports=XMLParser},{"../validator":5,"./OptionsBuilder":9,"./OrderedObjParser":10,"./node2json":12}],12:[function(require,module,exports){"use strict";function prettify(node,options){return compress(node,options)}function compress(arr,options,jPath){let text;const compressedObj={};for(let i=0;i<arr.length;i++){const tagObj=arr[i];const property=propName(tagObj);let newJpath="";if(jPath===undefined)newJpath=property;else newJpath=jPath+"."+property;if(property===options.textNodeName){if(text===undefined)text=tagObj[property];else text+=""+tagObj[property]}else if(property===undefined){continue}else if(tagObj[property]){let val=compress(tagObj[property],options,newJpath);const isLeaf=isLeafTag(val,options);if(tagObj[":@"]){assignAttributes(val,tagObj[":@"],newJpath,options)}else if(Object.keys(val).length===1&&val[options.textNodeName]!==undefined&&!options.alwaysCreateTextNode){val=val[options.textNodeName]}else if(Object.keys(val).length===0){if(options.alwaysCreateTextNode)val[options.textNodeName]="";else val=""}if(compressedObj[property]!==undefined&&compressedObj.hasOwnProperty(property)){if(!Array.isArray(compressedObj[property])){compressedObj[property]=[compressedObj[property]]}compressedObj[property].push(val)}else{if(options.isArray(property,newJpath,isLeaf)){compressedObj[property]=[val]}else{compressedObj[property]=val}}}}if(typeof text==="string"){if(text.length>0)compressedObj[options.textNodeName]=text}else if(text!==undefined)compressedObj[options.textNodeName]=text;return compressedObj}function propName(obj){const keys=Object.keys(obj);for(let i=0;i<keys.length;i++){const key=keys[i];if(key!==":@")return key}}function assignAttributes(obj,attrMap,jpath,options){if(attrMap){const keys=Object.keys(attrMap);const len=keys.length;for(let i=0;i<len;i++){const atrrName=keys[i];if(options.isArray(atrrName,jpath+"."+atrrName,true,true)){obj[atrrName]=[attrMap[atrrName]]}else{obj[atrrName]=attrMap[atrrName]}}}}function isLeafTag(obj,options){const{textNodeName}=options;const propCount=Object.keys(obj).length;if(propCount===0){return true}if(propCount===1&&(obj[textNodeName]||typeof obj[textNodeName]==="boolean"||obj[textNodeName]===0)){return true}return false}exports.prettify=prettify},{}],13:[function(require,module,exports){"use strict";class XmlNode{constructor(tagname){this.tagname=tagname;this.child=[];this[":@"]={}}add(key,val){if(key==="__proto__")key="#__proto__";this.child.push({[key]:val})}addChild(node){if(node.tagname==="__proto__")node.tagname="#__proto__";if(node[":@"]&&Object.keys(node[":@"]).length>0){this.child.push({[node.tagname]:node.child,[":@"]:node[":@"]})}else{this.child.push({[node.tagname]:node.child})}}}module.exports=XmlNode},{}],14:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],15:[function(require,module,exports){const hexRegex=/^[-+]?0x[a-fA-F0-9]+$/;const numRegex=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;if(!Number.parseInt&&window.parseInt){Number.parseInt=window.parseInt}if(!Number.parseFloat&&window.parseFloat){Number.parseFloat=window.parseFloat}const consider={hex:true,leadingZeros:true,decimalPoint:".",eNotation:true};function toNumber(str,options={}){options=Object.assign({},consider,options);if(!str||typeof str!=="string")return str;let trimmedStr=str.trim();if(options.skipLike!==undefined&&options.skipLike.test(trimmedStr))return str;else if(options.hex&&hexRegex.test(trimmedStr)){return Number.parseInt(trimmedStr,16)}else{const match=numRegex.exec(trimmedStr);if(match){const sign=match[1];const leadingZeros=match[2];let numTrimmedByZeros=trimZeros(match[3]);const eNotation=match[4]||match[6];if(!options.leadingZeros&&leadingZeros.length>0&&sign&&trimmedStr[2]!==".")return str;else if(!options.leadingZeros&&leadingZeros.length>0&&!sign&&trimmedStr[1]!==".")return str;else{const num=Number(trimmedStr);const numStr=""+num;if(numStr.search(/[eE]/)!==-1){if(options.eNotation)return num;else return str}else if(eNotation){if(options.eNotation)return num;else return str}else if(trimmedStr.indexOf(".")!==-1){if(numStr==="0"&&numTrimmedByZeros==="")return num;else if(numStr===numTrimmedByZeros)return num;else if(sign&&numStr==="-"+numTrimmedByZeros)return num;else return str}if(leadingZeros){if(numTrimmedByZeros===numStr)return num;else if(sign+numTrimmedByZeros===numStr)return num;else return str}if(trimmedStr===numStr)return num;else if(trimmedStr===sign+numStr)return num;return str}}else{return str}}}function trimZeros(numStr){if(numStr&&numStr.indexOf(".")!==-1){numStr=numStr.replace(/0+$/,"");if(numStr===".")numStr="0";else if(numStr[0]===".")numStr="0"+numStr;else if(numStr[numStr.length-1]===".")numStr=numStr.substr(0,numStr.length-1);return numStr}return numStr}module.exports=toNumber},{}],16:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.osmFetch=osmFetch;const auth_1=require("../auth");const config_1=require("../config");const _xml_1=require("./_xml");const toBase64=text=>{if(typeof btoa==="undefined"){return Buffer.from(text,"binary").toString("base64")}return btoa(text)};function osmFetch(path,qsObject,fetchOptions){return __awaiter(this,void 0,void 0,function*(){const{apiUrl,authHeader,basicAuth,userAgent}=(0,config_1.getConfig)();const maybeBasicAuthHeader=basicAuth&&`Basic ${toBase64(`${basicAuth.username}:${basicAuth.password}`)}`;const maybeOAuth2Token=(0,auth_1.getAuthToken)()&&`Bearer ${(0,auth_1.getAuthToken)()}`;let qs=new URLSearchParams(qsObject).toString();qs&&(qs=`?${qs}`);const response=yield fetch(`${apiUrl}/api${path}${qs}`,Object.assign(Object.assign({},fetchOptions),{headers:Object.assign({Authorization:authHeader||maybeBasicAuthHeader||maybeOAuth2Token||"","User-Agent":userAgent},fetchOptions===null||fetchOptions===void 0?void 0:fetchOptions.headers)}));const contentType=response.headers.get("Content-Type");if(contentType===null||contentType===void 0?void 0:contentType.startsWith("application/xml")){const xml=yield response.text();const json=yield _xml_1.xmlParser.parse(xml);return json}if(contentType===null||contentType===void 0?void 0:contentType.startsWith("application/json")){return response.json()}if(response.ok){return yield response.text()}const error=new Error(`OSM API: ${yield response.text()}`);error.cause=response.status;throw error})}}).call(this)}).call(this,require("buffer").Buffer)},{"../auth":50,"../config":52,"./_xml":17,buffer:2}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.xmlParser=void 0;const fast_xml_parser_1=require("fast-xml-parser");exports.xmlParser=new fast_xml_parser_1.XMLParser({ignoreAttributes:false,attributesGroupName:"$",attributeNamePrefix:"",isArray:tagName=>tagName!=="$"})},{"fast-xml-parser":3}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createChangesetMetaXml=createChangesetMetaXml;exports.createOsmChangeXml=createOsmChangeXml;const fast_xml_parser_1=require("fast-xml-parser");const builder=new fast_xml_parser_1.XMLBuilder({ignoreAttributes:false,attributeNamePrefix:"$",format:true,suppressEmptyNode:true,suppressBooleanAttributes:false});function createChangesetMetaXml(tags){return builder.build({osm:{changeset:{tag:Object.entries(tags).map(([$k,$v])=>({$k:$k,$v:$v}))}}})}const createGroup=(csId,features,isCreate)=>features.reduce((ac,f)=>{const base={$id:f.id,$version:isCreate?0:f.version,$changeset:csId,tag:Object.entries(f.tags||{}).map(([$k,$v])=>({$k:$k,$v:$v}))};switch(f.type){case"node":{const feat=Object.assign(Object.assign({},base),{$lat:f.lat,$lon:f.lon});return Object.assign(Object.assign({},ac),{node:[...ac.node,feat]})}case"way":{if(!f.nodes)throw new Error("Way has no nodes");const feat=Object.assign(Object.assign({},base),{nd:f.nodes.map($ref=>({$ref:$ref}))});return Object.assign(Object.assign({},ac),{way:[...ac.way,feat]})}case"relation":{if(!f.members)throw new Error("Relation has no members");const feat=Object.assign(Object.assign({},base),{member:f.members.map(m=>({$type:m.type,$ref:m.ref,$role:m.role}))});return Object.assign(Object.assign({},ac),{relation:[...ac.relation,feat]})}default:{return ac}}},{node:[],way:[],relation:[]});function createOsmChangeXml(csId,diff,metadata){return builder.build({osmChange:{$version:"0.6",$generator:"osm-api-js",changeset:metadata?{tag:Object.entries(metadata).map(([$k,$v])=>({$k:$k,$v:$v}))}:undefined,create:[createGroup(csId,diff.create,true)],modify:[createGroup(csId,diff.modify)],delete:[Object.assign({"$if-unused":true},createGroup(csId,diff.delete))]}})}},{"fast-xml-parser":3}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseOsmChangeJson=parseOsmChangeJson;exports.parseOsmChangeXml=parseOsmChangeXml;const _xml_1=require("../_xml");function parseTags(feat){if(!(feat===null||feat===void 0?void 0:feat.tag))return undefined;return Object.fromEntries(feat.tag.map(tag=>[tag.$.k,tag.$.v]))}function common(feat){return{changeset:+feat.$.changeset,id:+feat.$.id,timestamp:feat.$.timestamp,uid:+feat.$.uid,user:feat.$.user,version:+feat.$.version,tags:parseTags(feat)}}const mapSection=c=>{const feats=[];if(c.node){const nodes=c.node.map(n=>Object.assign(Object.assign({type:"node"},common(n)),{lat:+n.$.lat,lon:+n.$.lon}));feats.push(...nodes)}if(c.way){const ways=c.way.map(w=>{var _a;return Object.assign(Object.assign({type:"way"},common(w)),{nodes:((_a=w.nd)===null||_a===void 0?void 0:_a.map(n=>+n.$.ref))||[]})});feats.push(...ways)}if(c.relation){const relations=c.relation.map(r=>{var _a;return Object.assign(Object.assign({type:"relation"},common(r)),{members:((_a=r.member)===null||_a===void 0?void 0:_a.map(m=>({ref:+m.$.ref,role:m.$.role,type:m.$.type})))||[]})});feats.push(...relations)}return feats};function parseOsmChangeJson(raw){var _a,_b,_c,_d;const changesetTags=parseTags((_a=raw.osmChange[0].changeset)===null||_a===void 0?void 0:_a[0]);const diff={create:((_b=raw.osmChange[0].create)===null||_b===void 0?void 0:_b.flatMap(mapSection))||[],modify:((_c=raw.osmChange[0].modify)===null||_c===void 0?void 0:_c.flatMap(mapSection))||[],delete:((_d=raw.osmChange[0].delete)===null||_d===void 0?void 0:_d.flatMap(mapSection))||[]};if(changesetTags)diff.changeset=changesetTags;return diff}function parseOsmChangeXml(xml){const raw=_xml_1.xmlParser.parse(xml);return parseOsmChangeJson(raw)}},{"../_xml":17}],20:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.createChangesetComment=createChangesetComment;const _osmFetch_1=require("../_osmFetch");function createChangesetComment(changesetId,commentText){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${changesetId}/comment`,undefined,{method:"POST",body:`text=${encodeURIComponent(commentText)}`,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}})})}},{"../_osmFetch":16}],21:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getChangesetDiff=getChangesetDiff;const _osmFetch_1=require("../_osmFetch");const _parseOsmChangeXml_1=require("./_parseOsmChangeXml");function getChangesetDiff(id){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${id}/download`);return(0,_parseOsmChangeXml_1.parseOsmChangeJson)(raw)})}},{"../_osmFetch":16,"./_parseOsmChangeXml":19}],22:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]]}return t};Object.defineProperty(exports,"__esModule",{value:true});exports.listChangesets=listChangesets;exports.getChangeset=getChangeset;const _osmFetch_1=require("../_osmFetch");const mapRawChangeset=_a=>{var{comments}=_a,raw=__rest(_a,["comments"]);return Object.assign(Object.assign({},raw),{created_at:new Date(raw.created_at),closed_at:raw.closed_at?new Date(raw.closed_at):undefined,discussion:comments===null||comments===void 0?void 0:comments.map(comment=>Object.assign(Object.assign({},comment),{date:new Date(comment.date),uid:`${comment.uid}`}))})};function listChangesets(options){return __awaiter(this,void 0,void 0,function*(){const{only}=options,otherOptions=__rest(options,["only"]);const raw=yield(0,_osmFetch_1.osmFetch)("/0.6/changesets.json",Object.assign(Object.assign({},only&&{[only]:true}),otherOptions));return raw.changesets.map(mapRawChangeset)})}function getChangeset(id_1){return __awaiter(this,arguments,void 0,function*(id,includeDiscussion=true){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${id}.json`,includeDiscussion?{include_discussion:1}:{});return mapRawChangeset(raw.changeset)})}},{"../_osmFetch":16}],23:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});exports.createOsmChangeXml=exports.parseOsmChangeXml=void 0;__exportStar(require("./createChangesetComment"),exports);__exportStar(require("./getChangesetDiff"),exports);__exportStar(require("./getChangesets"),exports);__exportStar(require("./subscription"),exports);__exportStar(require("./uploadChangeset"),exports);var _parseOsmChangeXml_1=require("./_parseOsmChangeXml");Object.defineProperty(exports,"parseOsmChangeXml",{enumerable:true,get:function(){return _parseOsmChangeXml_1.parseOsmChangeXml}});var _createOsmChangeXml_1=require("./_createOsmChangeXml");Object.defineProperty(exports,"createOsmChangeXml",{enumerable:true,get:function(){return _createOsmChangeXml_1.createOsmChangeXml}})},{"./_createOsmChangeXml":18,"./_parseOsmChangeXml":19,"./createChangesetComment":20,"./getChangesetDiff":21,"./getChangesets":22,"./subscription":24,"./uploadChangeset":25}],24:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.subscribeToChangeset=subscribeToChangeset;exports.unsubscribeFromChangeset=unsubscribeFromChangeset;const _osmFetch_1=require("../_osmFetch");function subscribeToChangeset(changesetId){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${changesetId}/subscribe`,{},{method:"POST"})})}function unsubscribeFromChangeset(changesetId){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${changesetId}/unsubscribe`,{},{method:"POST"})})}},{"../_osmFetch":16}],25:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.uploadChangeset=uploadChangeset;const _osmFetch_1=require("../_osmFetch");const _createOsmChangeXml_1=require("./_createOsmChangeXml");function uploadChangeset(tags,diff){return __awaiter(this,void 0,void 0,function*(){const changesetXml=(0,_createOsmChangeXml_1.createChangesetMetaXml)(tags);const csId=+(yield(0,_osmFetch_1.osmFetch)("/0.6/changeset/create",undefined,{method:"PUT",body:changesetXml,headers:{"content-type":"application/xml; charset=utf-8"}}));const osmChangeXml=(0,_createOsmChangeXml_1.createOsmChangeXml)(csId,diff);yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${csId}/upload`,undefined,{method:"POST",body:osmChangeXml,headers:{"content-type":"application/xml; charset=utf-8"}});yield(0,_osmFetch_1.osmFetch)(`/0.6/changeset/${csId}/close`,undefined,{method:"PUT"});return+csId})}},{"../_osmFetch":16,"./_createOsmChangeXml":18}],26:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getApiCapabilities=getApiCapabilities;exports.getCapabilities=getCapabilities;const _osmFetch_1=require("./_osmFetch");function getApiCapabilities(){return __awaiter(this,void 0,void 0,function*(){return(0,_osmFetch_1.osmFetch)("/capabilities.json")})}function getCapabilities(){return __awaiter(this,void 0,void 0,function*(){const raw=yield getApiCapabilities();const out={limits:{maxArea:raw.api.area.maximum,maxNoteArea:raw.api.note_area.maximum,maxTracepointPerPage:raw.api.tracepoints.per_page,maxWayNodes:raw.api.waynodes.maximum,maxChangesetElements:raw.api.changesets.maximum_elements,maxTimeout:raw.api.timeout.seconds},policy:{imageryBlacklist:raw.policy.imagery.blacklist.map(item=>item.regex)}};return out})}},{"./_osmFetch":16}],27:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getFeature=getFeature;exports.getFeatures=getFeatures;exports.getFeatureAtVersion=getFeatureAtVersion;exports.getFeatureHistory=getFeatureHistory;exports.getWaysForNode=getWaysForNode;exports.getRelationsForElement=getRelationsForElement;const _osmFetch_1=require("./_osmFetch");function getFeature(type,id,full){return __awaiter(this,void 0,void 0,function*(){const suffix=full&&type!=="node"?"/full":"";const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/${type}/${id}${suffix}.json`);return raw.elements})}function getFeatures(type,ids){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/${type}s.json?${type}s=${ids.join(",")}`);return raw.elements})}function getFeatureAtVersion(type,id,version){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/${type}/${id}/${version}.json`);return raw.elements[0]})}function getFeatureHistory(type,id){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/${type}/${id}/history.json`);return raw.elements})}function getWaysForNode(nodeId){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/node/${nodeId}/ways.json`);return raw.elements})}function getRelationsForElement(type,id){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/${type}/${id}/relations.json`);return raw.elements})}},{"./_osmFetch":16}],28:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getMapData=getMapData;const _osmFetch_1=require("./_osmFetch");function getMapData(bbox){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)("/0.6/map.json",{bbox:bbox});return raw.elements})}},{"./_osmFetch":16}],29:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getPermissions=getPermissions;const _osmFetch_1=require("./_osmFetch");function getPermissions(){return __awaiter(this,void 0,void 0,function*(){return(0,_osmFetch_1.osmFetch)("/0.6/permissions.json")})}},{"./_osmFetch":16}],30:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getUIdFromDisplayName=getUIdFromDisplayName;const changesets_1=require("./changesets");function getUIdFromDisplayName(displayName){return __awaiter(this,void 0,void 0,function*(){const cs=yield(0,changesets_1.listChangesets)({display_name:displayName});if(!cs.length){throw new Error("Could not get uid because the user has never edited the map")}return cs[0].uid})}},{"./changesets":23}],31:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getUser=getUser;exports.getUsers=getUsers;const _osmFetch_1=require("./_osmFetch");function getUser(user){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/user/${user==="me"?"details":user}.json`);return Object.assign(Object.assign({},raw.user),{account_created:new Date(raw.user.account_created)})})}function getUsers(users){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)("/0.6/users",{users:users});return raw.users.map(u=>Object.assign(Object.assign({},u),{account_created:new Date(u.account_created)}))})}},{"./_osmFetch":16}],32:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./changesets"),exports);__exportStar(require("./messages"),exports);__exportStar(require("./notes"),exports);__exportStar(require("./preferences"),exports);__exportStar(require("./getCapabilities"),exports);__exportStar(require("./getFeature"),exports);__exportStar(require("./getMapData"),exports);__exportStar(require("./getPermissions"),exports);__exportStar(require("./getUIdFromDisplayName"),exports);__exportStar(require("./getUser"),exports)},{"./changesets":23,"./getCapabilities":26,"./getFeature":27,"./getMapData":28,"./getPermissions":29,"./getUIdFromDisplayName":30,"./getUser":31,"./messages":35,"./notes":40,"./preferences":45}],33:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.deleteMessage=deleteMessage;const _osmFetch_1=require("../_osmFetch");function deleteMessage(messageId){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/user/messages/${messageId}.json`,{},{method:"DELETE"});return raw.message})}},{"../_osmFetch":16}],34:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getMessage=getMessage;const _osmFetch_1=require("../_osmFetch");function getMessage(messageId){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/user/messages/${messageId}.json`);return raw.message})}},{"../_osmFetch":16}],35:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./deleteMessage"),exports);__exportStar(require("./getMessage"),exports);__exportStar(require("./listMessages"),exports);__exportStar(require("./sendMessage"),exports);__exportStar(require("./updateMessageReadStatus"),exports)},{"./deleteMessage":33,"./getMessage":34,"./listMessages":36,"./sendMessage":37,"./updateMessageReadStatus":38}],36:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.listMessages=listMessages;const _osmFetch_1=require("../_osmFetch");function listMessages(type){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/user/messages/${type}.json`);return raw.messages})}},{"../_osmFetch":16}],37:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.sendMessage=sendMessage;const _osmFetch_1=require("../_osmFetch");function sendMessage(options){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)("/0.6/user/messages.json",options,{method:"POST"});return raw.message})}},{"../_osmFetch":16}],38:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.updateMessageReadStatus=updateMessageReadStatus;const _osmFetch_1=require("../_osmFetch");function updateMessageReadStatus(messageId,isRead){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/user/messages/${messageId}.json`,{read_status:isRead},{method:"POST"});return raw.message})}},{"../_osmFetch":16}],39:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getNotesForQuery=getNotesForQuery;exports.getNotesForArea=getNotesForArea;exports.getNote=getNote;const _osmFetch_1=require("../_osmFetch");const featureToNote=feature=>{const[lng,lat]=feature.geometry.coordinates;return Object.assign(Object.assign({},feature.properties),{location:{lat:lat,lng:lng}})};function $getNotes(options,suffix){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/notes${suffix?"/search":""}.json`,options);return raw.features.map(featureToNote)})}function getNotesForQuery(options){return $getNotes(options,true)}function getNotesForArea(bbox){return $getNotes({bbox:bbox},false)}function getNote(noteId){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)(`/0.6/notes/${noteId}.json`);return featureToNote(raw)})}},{"../_osmFetch":16}],40:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./getNotes"),exports);__exportStar(require("./noteActions"),exports);__exportStar(require("./subscription"),exports)},{"./getNotes":39,"./noteActions":41,"./subscription":42}],41:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.createNote=createNote;exports.commentOnNote=commentOnNote;exports.reopenNote=reopenNote;const _osmFetch_1=require("../_osmFetch");function createNote(lat,lng,text){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)("/0.6/notes",{lat:lat,lon:lng,text:text})})}function commentOnNote(nodeId,text){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/notes/${nodeId}/comment`,{text:text})})}function reopenNote(nodeId,text){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/notes/${nodeId}/reopen`,{text:text})})}},{"../_osmFetch":16}],42:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.subscribeToNote=subscribeToNote;exports.unsubscribeFromNote=unsubscribeFromNote;const _osmFetch_1=require("../_osmFetch");function subscribeToNote(noteId){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/notes/${noteId}/subscription`,{},{method:"POST"})})}function unsubscribeFromNote(noteId){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/notes/${noteId}/subscription`,{},{method:"DELETE"})})}},{"../_osmFetch":16}],43:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.deletePreferences=deletePreferences;const _osmFetch_1=require("../_osmFetch");function deletePreferences(key){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/user/preferences/${key}.json`,{},{method:"DELETE"})})}},{"../_osmFetch":16}],44:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getPreferences=getPreferences;const _osmFetch_1=require("../_osmFetch");function getPreferences(){return __awaiter(this,void 0,void 0,function*(){const raw=yield(0,_osmFetch_1.osmFetch)("/0.6/user/preferences.json");return raw.preferences})}},{"../_osmFetch":16}],45:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./deletePreferences"),exports);__exportStar(require("./getPreferences"),exports);__exportStar(require("./updatePreferences"),exports)},{"./deletePreferences":43,"./getPreferences":44,"./updatePreferences":46}],46:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.updatePreferences=updatePreferences;const _osmFetch_1=require("../_osmFetch");function updatePreferences(key,value){return __awaiter(this,void 0,void 0,function*(){yield(0,_osmFetch_1.osmFetch)(`/0.6/user/preferences/${key}.json`,{},{method:"PUT",body:value})})}},{"../_osmFetch":16}],47:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createPopup=createPopup;function createPopup(loginUrl){let resolved=false;return new Promise((resolve,reject)=>{const[width,height]=[600,550];const settings=Object.entries({width:width,height:height,left:window.screen.width/2-width/2,top:window.screen.height/2-height/2}).map(([k,v])=>`${k}=${v}`).join(",");const popup=window.open("about:blank","oauth_window",settings);if(!popup)throw new Error("Popup was blocked");popup.location=loginUrl;window.authComplete=fullUrl=>{resolve(fullUrl);resolved=true};const intervalId=setInterval(()=>{if(popup.closed){if(!resolved)reject(new Error("Cancelled"));clearInterval(intervalId)}},500)})}},{}],48:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.exchangeCode=exchangeCode;const helpers_1=require("./helpers");function exchangeCode(fullUrl_1,_a){return __awaiter(this,arguments,void 0,function*(fullUrl,{options,pkceVerifier,state}){const responseQs=new URL(fullUrl).searchParams;const error=responseQs.get("error_description");const code=responseQs.get("code");const responseState=responseQs.get("state");if(error)throw new Error(error);if(!code)throw new Error("No code in OAuth response");if(!pkceVerifier||!state)throw new Error("No login in progress");if(state!==responseState)throw new Error("State Mismatch");const qs={grant_type:"authorization_code",code:code,redirect_uri:options.redirectUrl,client_id:options.clientId,code_verifier:pkceVerifier};const url=`${(0,helpers_1.getOAuthBaseUrl)()}/oauth2/token?${new URLSearchParams(qs).toString()}`;const request=yield fetch(url,{method:"POST",body:"",headers:{"Content-Type":"application/x-www-form-urlencoded"}});const exchangeResponse=yield request.json();if("error_description"in exchangeResponse){throw new Error(exchangeResponse.error_description)}const loginData={issuedAt:new Date(exchangeResponse.created_at*1e3).toISOString(),accessToken:exchangeResponse.access_token,scopes:exchangeResponse.scope.split(" ")};localStorage.setItem("__osmAuth",JSON.stringify(loginData));delete window.authComplete;return loginData})}},{"./helpers":49}],49:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.sha256=sha256;exports.getRandomString=getRandomString;exports.getOAuthBaseUrl=getOAuthBaseUrl;const config_1=require("../config");function sha256(text){return __awaiter(this,void 0,void 0,function*(){const data=(new TextEncoder).encode(text);const buf=yield window.crypto.subtle.digest("SHA-256",data);const base64=btoa(String.fromCharCode(...new Uint8Array(buf)));return base64.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")})}function getRandomString(){return[...window.crypto.getRandomValues(new Uint32Array(32))].map(m=>`0${m.toString(16)}`.slice(-2)).join("")}function getOAuthBaseUrl(){let baseUrl=(0,config_1.getConfig)().apiUrl;if(baseUrl==="https://api.openstreetmap.org"){baseUrl="https://www.openstreetmap.org"}return baseUrl}},{"../config":52}],50:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./oauth2"),exports)},{"./oauth2":51}],51:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.isLoggedIn=exports.getAuthToken=exports.authReady=void 0;exports.login=login;exports.logout=logout;const createPopup_1=require("./createPopup");const exchangeCode_1=require("./exchangeCode");const helpers_1=require("./helpers");function login(options){return __awaiter(this,void 0,void 0,function*(){if(!options.redirectUrl){throw new Error("You must include the 'redirectUrl' option")}if(!options.clientId){throw new Error("You must include the 'clientId' option")}if(!options.scopes){throw new Error("You must include the 'scopes' option")}const state=(0,helpers_1.getRandomString)();const pkceVerifier=(0,helpers_1.getRandomString)();const pkceChallenge=yield(0,helpers_1.sha256)(pkceVerifier);const qs={scope:options.scopes.join(" "),include_granted_scopes:"true",response_type:"code",state:state,redirect_uri:options.redirectUrl,client_id:options.clientId,code_challenge_method:"S256",code_challenge:pkceChallenge};const oauthPath=`/oauth2/authorize?${new URLSearchParams(qs).toString()}`;const path=options.switchUser?`/logout?referer=${encodeURIComponent(`/login?referer=${encodeURIComponent(oauthPath)}`)}`:oauthPath;const loginUrl=(0,helpers_1.getOAuthBaseUrl)()+path;const transaction={state:state,pkceVerifier:pkceVerifier,options:options};if(options.mode==="popup"){const fullUrl=yield(0,createPopup_1.createPopup)(loginUrl);return(0,exchangeCode_1.exchangeCode)(fullUrl,transaction)}if(options.mode==="redirect"){localStorage.set("__osmAuthTemp",JSON.stringify(transaction));window.location.replace(loginUrl);return undefined}throw new Error("options.mode must be 'popup' or 'redirect'")})}exports.authReady=(()=>__awaiter(void 0,void 0,void 0,function*(){var _a;if(typeof window==="undefined")return;const fullUrl=window.location.href;const loginState=localStorage.getItem("__osmAuthTemp");if(new URL(fullUrl).searchParams.get("code")){if((_a=window.opener)===null||_a===void 0?void 0:_a.authComplete){window.opener.authComplete(fullUrl);window.close()}else if(loginState){try{const transaction=JSON.parse(loginState);yield(0,exchangeCode_1.exchangeCode)(fullUrl,transaction);localStorage.removeItem("__osmAuthTemp")}catch(ex){console.error("OSM Auth Error",ex)}}else{}}}))();const getAuthToken=()=>{try{const maybeJson=localStorage.getItem("__osmAuth");return maybeJson?JSON.parse(maybeJson).accessToken:undefined}catch(_a){return undefined}};exports.getAuthToken=getAuthToken;const isLoggedIn=()=>!!(0,exports.getAuthToken)();exports.isLoggedIn=isLoggedIn;function logout(){localStorage.removeItem("__osmAuth")}},{"./createPopup":47,"./exchangeCode":48,"./helpers":49}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getConfig=void 0;exports.configure=configure;const config={apiUrl:"https://api.openstreetmap.org",userAgent:"https://github.com/k-yle/osm-api-js"};const getConfig=()=>config;exports.getConfig=getConfig;function configure(updatedConfig){Object.assign(config,updatedConfig)}},{}],53:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./api"),exports);__exportStar(require("./auth"),exports);__exportStar(require("./config"),exports);__exportStar(require("./types"),exports)},{"./api":32,"./auth":50,"./config":52,"./types":57}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})},{}],55:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}],56:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}],57:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./changesets"),exports);__exportStar(require("./features"),exports);__exportStar(require("./general"),exports);__exportStar(require("./messages"),exports);__exportStar(require("./notes"),exports);__exportStar(require("./osmPatch"),exports);__exportStar(require("./user"),exports)},{"./changesets":54,"./features":55,"./general":56,"./messages":58,"./notes":59,"./osmPatch":60,"./user":61}],58:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}],59:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}],60:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}],61:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{dup:54}]},{},[53])(53)});
